---
  apiVersion: 1.0.0
  metadata:
    generateName: java-openliberty
  projects:
    -
      name: default
      source:
        type: git
        location: "https://github.com/groeges/java-openliberty-default.git" 
    -
      name: simple
      source:
        type: git
        location: "https://github.com/groeges/java-openliberty-simple.git" 
    -
      name: kafka
      source:
        type: git
        location: "https://github.com/groeges/java-openliberty-kafka.git" 
  components:
    -
      type: chePlugin
      id: redhat/java/latest
      memoryLimit: 1512Mi
    -
      type: dockerimage
      image: groeges/ubi8-git:latest
      command: 
        - /gitClone.sh
      args: 
        - devfile-v1
        - https://github.com/groeges/java-openliberty-stack
        - /stack
      alias: stack
      memoryLimit: 768Mi
      mountSources: false
      volumes:
        - name: stack
          containerPath: /stack
    -
      type: dockerimage
      image: kabanero/ubi8-maven:0.3.1
      alias: tools
      memoryLimit: 768Mi
      command: ['tail']
      args: [ '-f', '/dev/null']
      endpoints:
        - name: '9080/tcp'
          port: 9080
      mountSources: true
      volumes:
        - name: stack
          containerPath: /stack
      env:
        - name: ODO_STACK_DIR
          value: /stack
  commands:
    - name: devInit
      actions:
        - type: exec
          component: tools
          command: "sleep 5 && /stack/project/bin/init-stack.sh && /stack/project/bin/run-stack.sh prep"
          workdir: /stack/project
    - name: devBuild
      actions:
        - type: exec
          component: tools
          command: "/stack/project/bin/run-stack.sh odobld"
          workdir: ${CHE_PROJECTS_ROOT}
    - name: devRun
      actions:
        - type: exec
          component: tools
          command: "/stack/project/bin/run-stack.sh odorun"
          workdir: ${CHE_PROJECTS_ROOT}
      attributes:
        restart: "false"