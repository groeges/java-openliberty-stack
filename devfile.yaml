---
  apiVersion: 1.0.0
  metadata:
    generateName: java-openliberty
  projects:
    -
      name: openlibertyproject
      source:
        type: git
        location: "https://github.com/groeges/java-openliberty-template-default.git" 
  components:
    -
      type: chePlugin
      id: redhat/java/latest
      memoryLimit: 1512Mi
    -
      type: dockerimage
      image: groeges/ubi8-git:latest
      command: 
        - /gitClone.sh
      args: 
        - devfile-v1
        - https://github.com/groeges/java-openliberty-stack
        - /stack
      alias: stack
      memoryLimit: 768Mi
      mountSources: false
      volumes:
        - name: stack
          containerPath: /stack
    -
      type: dockerimage
      image: kabanero/ubi8-maven:0.3.1
      alias: tools
      memoryLimit: 768Mi
      command: ['tail']
      args: [ '-f', '/dev/null']
      endpoints:
        - name: '9080/tcp'
          port: 9080
      mountSources: true
      volumes:
        - name: openlibertypvc
          containerPath: /data
        - name: stack
          containerPath: /stack
      env:
        - name: ODO_STACK_DIR
          value: /stack
        - name: ODO_PROJECT_DIR
          value: /projects/openlibertyproject
#    -
#      type: dockerimage
#      image: ajymau/openliberty-appsody-build-env:latest
#      alias: runtime
#      memoryLimit: 768Mi
#      command: ['tail']
#      args: [ '-f', '/dev/null']
#      #endpoints:
#      #  - name: '9080/tcp'
#      #    port: 9080
#      mountSources: false
#      volumes:
#        - name: openlibertypvc
#          containerPath: /data
  commands:
    - name: devInit
      actions:
        - type: exec
          component: tools
          command: "/stack/project/bin/init-stack.sh && /stack/project/bin/run-stack.sh prep"
          workdir: /stack/project
    - name: devBuild
      actions:
        - type: exec
          component: tools
          command: "/stack/project/bin/run-stack.sh odobld"
          workdir: /projects/openlibertyproject
    - name: devRun
      actions:
        - type: exec
          component: tools
          command: "/stack/project/bin/run-stack.sh odorun"
          workdir: /projects/openlibertyproject
      attributes:
        restart: "false"